(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}}},t=async(e,t)=>{const s="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,o="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const l=await s.get([e]);if(o.lastError)throw new Error(`Error retrieving ${e}: ${o.lastError.message}`);return null!=l[e]?l[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function s(e,t,s){const o="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((l,a)=>{o.sendMessage({source:e,type:t,data:s},(e=>{o.lastError?a(new Error(`Error sending message: ${o.lastError.message}`)):l(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}async function o(e){return new Promise((t=>setTimeout(t,e)))}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=document.getElementById("captcha-message");o||(o=document.createElement("div"),o.id="captcha-message",o.style.zIndex="99999999",o.style.padding="3px 3px",o.style.borderRadius="3px",o.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",o.style.fontSize="10px",o.style.fontWeight="600",o.style.fontFamily="Arial, sans-serif",o.style.textAlign="center",o.style.whiteSpace="nowrap",o.style.color="white",o.style.top="1px",s&&s.parentElement?(o.style.position="absolute",o.style.left="2px",s.parentElement.appendChild(o)):(o.style.position="fixed",o.style.left="1px",document.body.appendChild(o)));const l={success:"linear-gradient(90deg, #6a11cb,rgb(191, 37, 252))",error:"linear-gradient(90deg, #ff416c, #ff4b2b)",warning:"linear-gradient(90deg, #ff9a44, #fc6076)",info:"linear-gradient(90deg, #17a2b8, #138496)"};o.innerText="[OMOcaptcha.com] "+e,o.style.background=l[t]||l.success,o.style.display="block"}function a(e,t){return new Promise((s=>{const o=Date.now(),l=setInterval((()=>{for(const t of e){if(document.querySelector(t))return clearInterval(l),void s(!0)}Date.now()-o>=t&&(clearInterval(l),s(!1))}),500)}))}function n(e){["pointerdown","mousedown","mouseup","click"].forEach((function(t){e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window}))}))}async function r(e){console.log("Vao createTask utils");try{const t=await s("SOURCE","createTask",e);return t||(console.error("No response from createTask"),"")}catch(e){return console.error("Failed to create task:",e),""}}async function c(e,t,o){const l=JSON.stringify({clientKey:e,taskId:t});try{const e=await s("SOURCE","getTaskResult",{data:l,timeWait:o});return e?"fail"===e.status?(console.error("API error:",e),{errorDescription:e.errorDescription}):e.solution?e.solution:e.type?e:(console.error("Invalid API response: missing solution"),null):(console.error("No result returned from getTaskResult"),null)}catch(e){return console.error("Failed to get task result:",e),null}}async function i(e){try{if(e instanceof Element&&e.src&&(e=e.src),"string"!=typeof e||!e.startsWith("http"))return console.warn("[utils] fetchImageBase64ByBackground: invalid input",e),"";const t=await new Promise((t=>{chrome.runtime.sendMessage({type:"createImageBase64",data:{url:e}},(e=>{const s=chrome.runtime.lastError;if(s)return console.warn("[utils] Background message error:",s.message),t("");t(e||"")}))}));return t||(console.warn("[utils] fetchImageBase64ByBackground: Empty response for",e),"")}catch(e){return console.error("[utils] fetchImageBase64ByBackground error:",e),""}}async function u(e){for(let t=0;t<5;t++){const t=getComputedStyle(e),s=t.backgroundImage.match(/url\(["']?(.*?)["']?\)/)?.[1];if(s&&"none"!==s){const e=new URL(s,window.location.href).href;return await i(e)}await o(500)}return console.warn("[utils] No background image found after retries"),""}let g,d,y,f,h,p;async function m(){g=await t(e.POWER_ON.key,e.POWER_ON.defaultValue),d=await t(e.API_KEY.key,e.API_KEY.defaultValue);const s=await t(e.GEETEST.key,e.GEETEST.defaultValue);y=s.delayClick,f=s.delaySwipe,h=s.loop,p=s.isActive}console.log("Run file Geetest:",window.location.href);let b=!1,w="";async function k(){for(console.log("[Geetest] This is captchaGobang");;){await o(700);let e=null;for(let t=0;t<10&&(e=document.querySelector('[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_winlinze"]'),null==e);t++)await o(1e3);if(!e)return;let t=document.querySelector('[class*="geetest_box"][style*="display: block;"] [class*="geetest_header"] [class*="geetest_title"]');l("Captcha Gobang","red",t),l("Get image...","red",t);let s="";for(let t=0;t<10;t++){if(s=await I(e),s&&w!==s){w=s;break}await o(1e3)}if(!s)return;console.log("[Geetest] This is imgBase64>>>",s),l("Create task...","red",t);const a=JSON.stringify({clientKey:d,task:{type:"GeetestGobangWebTask",imageBase64:s}}),n=await r(a);if(!n||n.error){if(l(n?n.errorDescription:"No response","red",t),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}l("Get result...","red",t);const i=await c(d,n.taskId,30);if(console.log("[Geetest] This is result",i),!i||i.errorDescription){if(l(i?i.errorDescription:"No result from API","red",t),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}const u=document.querySelectorAll(".geetest_subitem .geetest_itemimg");l("Solving...","red",t),await A(u,i.swap_positions),await o(3500);if(document.querySelector('[class*="geetest_box"][style="display: block;"]')){if(console.warn("[Geetest] Giải captcha thất bại ❌"),l("Solve failed","red",t),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}return void console.log("[Geetest] Giải captcha thành công ✅ (captcha đã biến mất)")}}async function _(){for(console.log("[Geetest] This is captchaKeoTha");;){await o(1500);let t=null;for(let e=0;e<10&&(t=document.querySelector('[class*="geetest_box"][style="display: block;"] [class*="geetest_slide"] [class*="geetest_window"]'),null==t);e++)await o(1e3);if(console.log("[Geetest] This is image:",t),!t)return;let s=document.querySelector('[class*="geetest_box"][style*="display: block;"] [class*="geetest_header"] [class*="geetest_title"]');l("Captcha slide","red",s),l("Get image...","red",s);let a="";for(let e=0;e<10;e++){if(a=await G(t),a&&w!==a){w=a;break}await o(1e3)}if(!a)return;console.log("[Geetest] This is imgBase64:",a),l("Create task...","red",s);const n=JSON.stringify({clientKey:d,task:{type:"GeetestSliderWebTask",imageBase64:a}}),i=await r(n);if(!i||i.error){if(l(i?i.errorDescription:"No response","red",s),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}l("Get result...","red",s);const u=await c(d,i.taskId,30);if(console.log("[Geetest] This is result:",u),!u||u.errorDescription){if(l(u?u.errorDescription:"No result from API","red",s),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}let g=parseInt(u.end.x,10);var e=document.querySelector('[class*="geetest_box"][style="display: block;"] [class*="geetest_slide"] [class*="geetest_window"]>[class*="geetest_slice"]');l("Captcha slide solving...","red",s),await E(e,g),await o(3500);if(document.querySelector('[class*="geetest_box"][style="display: block;"]')){if(console.warn("[Geetest] Giải captcha thất bại ❌"),l("Solve failed","red",s),h)continue;return}return void console.log("[Geetest] Giải captcha thành công ✅ (captcha đã biến mất)")}}async function S(){for(console.log("[Geetest] This is captchaClick");;){await o(700);let e=null;for(let t=0;t<10&&(e=document.querySelector('[class*="geetest_box"][style="display: block;"] [class*="geetest_click"]>[class*="geetest_window"] [class*="geetest_bg"]'),null==e);t++)await o(1500);if(console.log("[Geetest] This is image:",e),!e)return;let t=document.querySelector('[class*="geetest_box"][style*="display: block;"] [class*="geetest_header"] [class*="geetest_title"]');l("Captcha Click","red",t);let s="";for(let t=0;t<10;t++){const t=getComputedStyle(e).backgroundImage;if(t&&"none"!==t&&(s=await u(e),s&&w!==s)){w=s;break}await o(1e3)}if(!s)return;console.log("[Geetest] This is image base64 captcha click:",s);let a=[];for(let e=0;e<5;e++){const t=document.querySelectorAll("[class*='geetest_ques_tips geetest_ques_back'] img");a=[];for(let e=0;e<t.length;e++)try{const s=await i(t[e]);a.push(s)}catch(t){console.error(`Lỗi khi xử lý icon ${e+1}:`,t),a.push(null)}if(3===a.length&&a.every((e=>null!==e)))break;console.warn(`[Geetest] Chưa đủ 3 icon hợp lệ, thử lại lần ${e+1}`),await o(1e3)}if(console.log("Số icon:",a.length),3!==a.length||a.some((e=>!e))){if(console.warn("[Geetest] Không đủ 3 icon hợp lệ, bỏ qua lần này."),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}l("Create task...","red",t);const n={type:"GeetestIconWebTask",imageBase64:s,anchorImageBase64s:[a[0],a[1],a[2]]},g=JSON.stringify({clientKey:d,task:n}),y=await r(g);if(!y||y.error){if(l(y?y.errorDescription:"No response","red",t),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}l("Get result...","red",t);const f=await c(d,y.taskId,30);if(console.log("[Geetest] This is result:",f),!f||f.errorDescription){if(l(f?f.errorDescription:"No result from API","red",t),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}l("Clicking...","red",t);let p=parseInt(f.points[0].x,10),m=parseInt(f.points[0].y,10),b=parseInt(f.points[1].x,10),k=parseInt(f.points[1].y,10),_=parseInt(f.points[2].x,10),S=parseInt(f.points[2].y,10);q(e,p,m),await o(500),q(e,b,k),await o(500),q(e,_,S),await o(500),document.querySelector('[class*="geetest_click"] [class*="geetest_submit"]').click(),await o(3500);if(document.querySelector('[class*="geetest_box"][style="display: block;"]')){if(console.warn("[Geetest] Captcha click thất bại ❌"),l("Solve failed","red",t),h)continue;return}return void console.log("[Geetest] Captcha click thành công ✅ (captcha đã biến mất)")}}async function v(){for(console.log("[Geetest] This is captchaIconCrush");;){await o(1e3);let e=null;for(let t=0;t<10&&(e=document.querySelector('[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_match"]'),null==e);t++)await o(1e3);if(!e)return;let t=document.querySelector('[class*="geetest_box"][style*="display: block;"] [class*="geetest_header"] [class*="geetest_title"]');l("Captcha IconCrush","red",t),l("Get image...","red",t);let s="";for(let t=0;t<10;t++){if(s=await T(e),s&&w!==s){w=s;break}await o(1e3)}if(!s)return;console.log("[Geetest] This is imgBase64",s),l("Create task...","red",t);const a=JSON.stringify({clientKey:d,task:{type:"GeetestIconCrushWebTask",imageBase64:s}}),n=await r(a);if(!n||n.error){if(l(n?n.errorDescription:"No response","red",t),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}l("Get result...","red",t);const i=await c(d,n.taskId,30);if(console.log("[Geetest] This is result:",i),!i||i.errorDescription){if(l(i?i.errorDescription:"No result from API","red",t),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}l("Solving...","red",t);const u=document.querySelectorAll(".geetest_backimg");await P(u,i.swap_positions),await o(3500);if(document.querySelector('[class*="geetest_box"][style="display: block;"]')){if(console.warn("[Geetest] Giải captcha thất bại ❌"),l("Solve failed","red",t),h){document.querySelector('[class*="geetest_box"][style="display: block;"] button[class*="geetest_refresh"]').click();continue}return}return void console.log("[Geetest] Giải captcha thành công ✅ (captcha đã biến mất)")}}async function x(){for(console.log("[Geetest] This is captchaImage");;){await o(700);const e=document.querySelector('[class*="geetest_box"][style*="display: block;"]');if(!e){await o(1e3);continue}let t=null;for(let s=0;s<20&&(t=e.querySelector('[class*="geetest_box"][style*="display: block;"] [class*="geetest_nine"] [class*="geetest_window"] [class*="geetest_item"] [class*="geetest_item_img"]'),!t);s++)await o(500);if(console.log("[Geetest] This is image:",t),!t)return;const s=e.querySelector('[class*="geetest_box"][style*="display: block;"] [class*="geetest_header"] [class*="geetest_title"]');l("Captcha Image","red",s);let a="";for(let e=0;e<10;e++){const e=getComputedStyle(t).backgroundImage;if(e&&"none"!==e&&(a=await u(t),a&&w!==a)){w=a;break}await o(1e3)}if(!a)return void console.warn("[Geetest] Không lấy được ảnh base64 hợp lệ");console.log("[Geetest] This is image base64 captcha image:",a);let g=null;for(let t=0;t<5;t++){const s=e.querySelector('[class*="geetest_box"][style*="display: block;"] [class*="geetest_ques_tips"][class*="geetest_ques_back"] img');if(s)try{g=await i(s)}catch(e){console.error("[Geetest] Lỗi khi xử lý icon:",e),g=null}if(g)break;console.warn(`[Geetest] Icon chưa sẵn sàng, thử lại lần ${t+1}`),await o(1e3)}if(!g){if(console.warn("[Geetest] Không lấy được icon hợp lệ, bỏ qua lần này."),h){e.querySelector('[class*="geetest_box"][style*="display: block;"] button[class*="geetest_refresh"]')?.click(),await o(1e3);continue}return}const y=e.querySelector('[class*="geetest_box"][style*="display: block;"] [class*="geetest_header"] .geetest_text_tips'),f=y?y.textContent.replace(/\s+/g," ").trim():null;l("Create task...","red",s);const p={type:"GeetestSelectObjectTask",imageBase64:a,question:f,anchor:g};console.log("This is data:",p);const m=JSON.stringify({clientKey:d,task:p}),b=await r(m);if(!b||b.error){if(l(b?b.errorDescription:"No response","red",s),h){e.querySelector('[class*="geetest_box"][style*="display: block;"] button[class*="geetest_refresh"]')?.click(),await o(1e3);continue}return}l("Get result...","red",s);const k=await c(d,b.taskId,30);if(console.log("[Geetest] This is result:",k),!k||k.errorDescription){if(l(k?k.errorDescription:"No result from API","red",s),h){e.querySelector('[class*="geetest_box"][style*="display: block;"] button[class*="geetest_refresh"]')?.click(),await o(1e3);continue}return}l("Clicking...","red",s);const _=document.querySelectorAll('[class*="geetest_box"][style*="display: block;"] [class*="geetest_nine"] [class*="geetest_window"] .geetest_item .geetest_item_ghost'),S=k.objects;for(let e=0;e<S.length;e++)e>0&&await o(50+Math.floor(51*Math.random())),n(_[S[e]]);await o(3500);if(document.querySelector('[class*="geetest_box"][style*="display: block;"]')){if(console.warn("[Geetest] Captcha click thất bại ❌"),l("Solve failed","red",s),h){await o(500);continue}return}return void console.log("[Geetest] Captcha click thành công ✅ (captcha đã biến mất)")}}function C(e){return!!document.querySelector(e)}async function E(e,t){return new Promise((s=>{if(!e)return s();e.parentElement;const l=t,a=new DataTransfer,n=f;function r(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,...s})),e.dispatchEvent(new PointerEvent(t,{bubbles:!0,cancelable:!0,...s,pointerType:"mouse",isPrimary:!0}))}(async()=>{r("mouseenter"),r("mouseover"),await o(n),r("pointerdown",{clientX:0,clientY:0}),r("mousedown",{clientX:0,clientY:0}),e.dispatchEvent(new DragEvent("dragstart",{bubbles:!0,cancelable:!0,dataTransfer:a}));let c=0,i=0;for(;c+10<t;){const e=c/t;let s;s=e<.3?2*Math.random()+1:e<.7?6*Math.random()+2:2*Math.random()+.5,c+=s,i+=8*(Math.random()-.5);const a=Math.min(c,l),u=i;r("mousemove",{clientX:a,clientY:u}),r("pointermove",{clientX:a,clientY:u}),await o(n)}c=t;const u=i;r("mousemove",{clientX:c,clientY:u}),r("pointermove",{clientX:c,clientY:u}),await o(n),r("pointerup",{clientX:c,clientY:u}),r("mouseup",{clientX:c,clientY:u}),e.dispatchEvent(new DragEvent("dragend",{bubbles:!0,cancelable:!0,dataTransfer:a})),console.log("Vị trí backend >>>",t),console.log(`Vị trí cuối cùng của element: x = ${c}, y = ${u}`),s()})()}))}async function G(e){return new Promise((async(t,s)=>{try{if(!(e instanceof HTMLElement))return t("");const o=e.getBoundingClientRect(),l=Math.round(o.width),a=Math.round(o.height);if(l<=0||a<=0)return t("");const n=document.createElement("canvas");n.width=l,n.height=a;const r=n.getContext("2d");async function c(e){return new Promise((t=>{chrome.runtime.sendMessage({type:"createImageBase64",data:{url:e}},(e=>{const s=chrome.runtime.lastError;if(s)return console.warn("[capture] background error:",s.message),t(null);if(!e)return t(null);const o=new Image;o.src="data:image/png;base64,"+e,o.onload=()=>t(o),o.onerror=()=>t(null)}))}))}function i(e){if(!e)return"";const t=getComputedStyle(e).backgroundImage.match(/url\(["']?(.*?)["']?\)/);return t?new URL(t[1],window.location.href).href:""}async function u(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500;for(let l=0;l<s;l++){const s=e.querySelector(t);if(s){const e=i(s);if(e&&"none"!==e)return{el:s,url:e}}await new Promise((e=>setTimeout(e,o)))}return{el:null,url:""}}const{el:g,url:d}=await u(".geetest_bg")||await u('[class*="geetest_bg"]');if(!g||!d)return s(new Error("Không tìm thấy ảnh nền Geetest"));const y=await c(d);if(!y)return s(new Error("Không tải được ảnh nền"));r.drawImage(y,0,0,l,a);const f=e.querySelector(".geetest_slice")||e.querySelector('[class*="geetest_slice"]'),h=f?.querySelector(".geetest_slice_bg")||f?.querySelector('[class*="geetest_slice_bg"]');if(f&&h){const p=i(h);if(p){const m=await c(p);if(m){const b=f.getBoundingClientRect(),w=e.getBoundingClientRect(),k=Math.round(b.left-w.left),_=Math.round(b.top-w.top),S=Math.round(b.width),v=Math.round(b.height);S>0&&v>0&&r.drawImage(m,k,_,S,v)}}}t(n.toDataURL("image/jpeg").split(",")[1]||"")}catch(x){console.error("[captcha] Lỗi khi render Geetest:",x),s(x)}}))}async function I(e){if(!e)return void console.error("Không tìm thấy board!");const t=getComputedStyle(e).backgroundColor||"#dce3ed",s=e.querySelectorAll(".geetest_item"),o=s.length,l=s[0]?.querySelectorAll(".geetest_itemimg").length||0;if(0===o||0===l)return void console.error("Không tìm thấy lưới!");const a=s[0].querySelector(".geetest_itemimg").getBoundingClientRect(),n=a.width,r=a.height,c=document.createElement("canvas");c.width=n*l,c.height=r*o;const i=c.getContext("2d");i.fillStyle=t,i.fillRect(0,0,c.width,c.height);const u=[];s.forEach(((e,t)=>{e.querySelectorAll(".geetest_itemimg").forEach(((e,s)=>{const o=getComputedStyle(e).backgroundImage.match(/url\("(.+)"\)/);if(o){const e=o[1];u.push({type:"image",imgUrl:e,row:t,col:s})}else u.push({type:"empty",row:t,col:s})}))}));for(const e of u){const t=e.col*n,s=e.row*r,o=.8,l=n*o,a=r*o,c=t+(n-l)/2,u=s+(r-a)/2;if("image"===e.type)try{const t=await M(e.imgUrl);i.drawImage(t,c,u,l,a)}catch(t){console.error("Lỗi tải ảnh:",e.imgUrl,t)}else i.fillStyle="rgba(200, 210, 220, 1)",i.beginPath(),i.arc(t+n/2,s+r/2,Math.min(n,r)*o*.5,0,2*Math.PI),i.fill()}return c.toDataURL("image/jpeg").split(",")[1]}function q(e,t,s){var o=e.getBoundingClientRect(),l=o.left+t,a=o.top+s,n=new MouseEvent("click",{bubbles:!0,clientX:l,clientY:a});e.dispatchEvent(n)}async function T(e){if(!e)return void console.error("Không tìm thấy board!");const t=getComputedStyle(e).backgroundColor||"#ffffff",s=Array.from(e.querySelectorAll('[class*="geetest_img"]'));if(9!==s.length)return void console.error("Không đủ 9 hình!");const o=[];for(let e=0;e<3;e++)for(let t=0;t<3;t++)o.push(s[3*t+e]);const l=document.createElement("canvas");l.width=200,l.height=200;const a=l.getContext("2d");a.fillStyle=t,a.fillRect(0,0,l.width,l.height);const n=200/3,r=.9*n,c=3.333333333333332;for(let e=0;e<9;e++){const t=Math.floor(e/3),s=e%3,l=getComputedStyle(o[e]).backgroundImage.match(/url\("(.+)"\)/);if(!l)continue;const i=l[1];try{const e=await M(i),o=s*n,l=t*n;a.drawImage(e,o+c,l+c,r,r)}catch(e){console.error("Lỗi tải ảnh:",i,e)}}return l.toDataURL("image/jpeg").split(",")[1]}async function A(e,t){for(const s of t){const t=s-1;e[t]&&(e[t].click(),console.log("Da click"),await o(500))}}async function P(e,t){for(const s of t){const t=s-1,l=3*(t%3)+Math.floor(t/3),a=e[l];a?(a.click(),console.log("[Geetest] Clicked at",l),await o(500)):console.warn("[Geetest] Không tìm thấy element tại",l)}}function D(e){return new Promise(((t,s)=>{const o=new Image;o.crossOrigin="Anonymous",o.onload=()=>t(o),o.onerror=s,o.src=e}))}async function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;for(let l=1;l<=t;l++)try{return await D(e)}catch(a){if(console.warn(`[retry] Lỗi lần ${l} khi tải ảnh: ${e}`),l===t)throw a;await o(s)}}(async()=>{await m();new MutationObserver((async(e,t)=>{await async function(e){if(await m(),g&&p&&d&&"YOUR_CLIEN_KEY"!==d){console.log("[Geetest] handleElementMutation");for(const t of e)if("childList"===t.type){if(!document.querySelector('[class*="geetest_container"]')||b)continue;if(!d)return;b=!0;try{if(await o(1e3),!await a(['[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_slide"]','[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_winlinze"]','[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_click"]','[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_match"]','[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_nine"]'],1e4))return;console.log("[Geetest] Tìm thấy elementExists");for(let e=0;e<20;e++){if(C('[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_winlinze"]')){await k();break}if(C('[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_slide"]')){await _();break}if(C('[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_click"]')){await S();break}if(C('[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_match"]')){await v();break}if(C('[class*="geetest_box"][style="display: block;"] [class*="geetest_container"] [class*="geetest_nine"]')){await x();break}await o(1e3)}}finally{b=!1}}}}(e)})).observe(document.body,{childList:!0,subtree:!0});for(let e=0;e<15;e++){const e=document.querySelector('[class*="geetest_holder"] [class*="geetest_btn_click"]');if(document.querySelector('[class*="geetest_box"][style="display: block;"] [class*="geetest_container"]')){console.log("Captcha đã xuất hiện, thoát vòng lặp");break}e&&(console.log("This is click"),n(e)),await o(800)}})()})();