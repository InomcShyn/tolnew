(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}}};async function t(e,t,a){const o="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((c,n)=>{o.sendMessage({source:e,type:t,data:a},(e=>{o.lastError?n(new Error(`Error sending message: ${o.lastError.message}`)):c(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}const a=async(e,t)=>{const a="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,o="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const c=await a.get([e]);if(o.lastError)throw new Error(`Error retrieving ${e}: ${o.lastError.message}`);return null!=c[e]?c[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function o(e){return new Promise((t=>setTimeout(t,e)))}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeout:5e3,maxRetries:3,typeImage:"png"};try{const{timeout:a,maxRetries:c,typeImage:n}=t,r=`image/${n||"png"}`,i={arkoselabs:"image/jpeg"};function l(e){for(const[t,a]of Object.entries(i))if(e.includes(t))return a;return r}if(e instanceof HTMLCanvasElement||e.tagName&&"CANVAS"===e.tagName.toUpperCase())try{if(0===e.width||0===e.height)return console.log("Canvas rỗng hoặc không có kích thước"),"";const s=e.getBoundingClientRect(),u=s.width,g=s.height,m=document.createElement("canvas");m.width=u,m.height=g;m.getContext("2d").drawImage(e,0,0,u,g);const h=m.toDataURL(r).split(",")[1];return h||(console.log("Không thể lấy base64 từ canvas"),"")}catch(p){return console.log("Lỗi khi chụp màn hình canvas:",p),""}if(e instanceof Element)try{const d=e.src;if(d&&d.startsWith("data:image/")){const f=d.split(",")[1];return f||(console.log("Base64 rỗng từ src của element"),"")}e=d||""}catch(w){return console.log("Lỗi khi xử lý element:",w),""}if("string"==typeof e&&e.startsWith("blob:")){console.log("Da vao blob");try{return await new Promise((t=>{const a=new Image;a.setAttribute("crossOrigin","anonymous");const o=setTimeout((()=>{t("")}),1e3);a.onload=function(){console.log("Vao trong onload"),clearTimeout(o);try{const a=document.createElement("canvas");a.width=this.naturalWidth,a.height=this.naturalHeight;a.getContext("2d").drawImage(this,0,0);const o=l(e);a.toBlob((e=>{if(!e)return void t("");const a=new FileReader;a.onloadend=()=>{const e=a.result.split(",")[1];t(e)},a.onerror=()=>t(""),a.readAsDataURL(e)}),o)}catch(e){console.log("Lỗi khi xử lý blob URL:",e),t("")}},a.onerror=()=>{clearTimeout(o),t("")},a.src=e,console.log("This is img:"),console.log("img src:",a.src)}))}catch(y){return console.log("Lỗi khi xử lý blob URL:",y),""}}if("string"==typeof e){console.log("Vao den input string:");try{for(let k=0;k<c;k++)try{const b=new AbortController,S=setTimeout((()=>b.abort()),a),C=await fetch(e,{signal:b.signal});if(clearTimeout(S),!C.ok)throw new Error(`HTTP error ${C.status}`);const I=await C.blob();return await new Promise(((e,t)=>{const a=new FileReader;a.onloadend=()=>e(a.result.split(",")[1]),a.onerror=()=>t(new Error("Failed to read blob as base64")),a.readAsDataURL(I)}))}catch(v){if(k===c-1)return console.log("Hết lượt thử fetch:",v),"";await o(500)}}catch(E){return console.log("Lỗi khi fetch URL:",E),""}}return console.log("Đầu vào không được hỗ trợ:",e),""}catch(A){return console.log("Lỗi chung trong fetchImageToBase64:",A),""}}const n=window.location.hostname,r={"www.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="_r_"]'},"en-gb.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="_r_"]'},"web.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="_r_"]'},"m.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="captcha_response"]'},"free.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="captcha_response"]'},"signin.aws.amazon.com":{captchaImageSelector:'[class*="awsui_child"] img[id*="captcha_image"]',inputSelector:'[class*="awsui"] input[class*="awsui_input"]'},"cdn.us-east-1.threat-mitigation.aws.amazon.com":{captchaImageSelector:'img[alt*="captcha"]',inputSelector:'input[name*="captcha"]'},"2captcha.com":{captchaImageSelector:'img[class*="_captchaImage"]',inputSelector:'input[id*="simple-captcha-field"]'},"demos.telerik.com":{captchaImageSelector:'img[id*="_CaptchaImage"]',inputSelector:'input[class*="rfdTextInput"]'},"captcha.com":{captchaImageSelector:'img[id*="demoCaptcha_CaptchaImage"]',inputSelector:'input[id*="captchaCode"]'},"register.rediff.com":{captchaImageSelector:'[class="captchaImageCnt"] img[class*="captchaImage"]',inputSelector:'form[name*="register_mail"] input[class*="captcha"]'},"iforgot.apple.com":{captchaImageSelector:'[class="idms-captcha-wrapper"] [class*="img-wrapper"] img',inputSelector:'[class*="captcha-input-container"] input[class*="captcha-input"]'},"id.zing.vn":{captchaImageSelector:'img[src*="zing.vn/captcha2"]',inputSelector:'input[name="captcha"]'},"accounts.zoho.com":{captchaImageSelector:'img[id*="captcha-image"]',inputSelector:'.captcha_holder input[id*="captcha"]'},"poczta.interia.pl":{captchaImageSelector:'img[id*="captcha__img"]',inputSelector:'input[id*="captcha[input]"]'},"www.instagram.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'textarea[data-bloks-name*="bk.components.TextInput"]'}}[n];let i,l;console.log("[image-to-text] This is hostname:",n),r||console.log("[image-to-text] Không có config cho trang:",n),console.log("Run file ImageToText",window.location.href);let s="",u=!1;async function g(){if(u)return;console.log("Running captchaImageToText");const e=document.querySelector(r.inputSelector);if(!e)return;let a=null;for(let e=0;e<10&&(a=document.querySelector(r.captchaImageSelector),!a);e++)await o(1e3);if(!a)return;let i="";for(let e=0;e<10;e++){switch(n){case"signin.aws.amazon.com":case"www.facebook.com":case"en-gb.facebook.com":case"m.facebook.com":case"free.facebook.com":case"web.facebook.com":case"id.zing.vn":case"accounts.zoho.com":case"poczta.interia.pl":case"cdn.us-east-1.threat-mitigation.aws.amazon.com":case"www.instagram.com":i=await t("IMAGETOTEXT","createImageBase64",{url:a.src});break;case"register.rediff.com":i=m(a);break;default:i=await c(a)}if(i&&i!==s){s=i;break}await o(1e3)}if(!i)return;console.log("[image-to-text] This is base64",i);const g=JSON.stringify({clientKey:l,task:{type:"ImageToTextTask",imageBase64:i}}),h=await async function(e){console.log("Vao createTask utils");try{return await t("SOURCE","createTask",e)||(console.error("No response from createTask"),"")}catch(e){return console.error("Failed to create task:",e),""}}(g);if(!h||h.error)return;const p=await async function(e,a,o){const c=JSON.stringify({clientKey:e,taskId:a});try{const e=await t("SOURCE","getTaskResult",{data:c,timeWait:o});return e?"fail"===e.status?(console.error("API error:",e),{errorDescription:e.errorDescription}):e.solution?e.solution:e.type?e:(console.error("Invalid API response: missing solution"),null):(console.error("No result returned from getTaskResult"),null)}catch(e){return console.error("Failed to get task result:",e),null}}(l,h.taskId,30);p&&!p.errorDescription&&(e.value=p.text,e.dispatchEvent(new Event("input",{bubbles:!0})),u=!0,console.log("[image-to-text] Captcha solved successfully, stop solving."))}function m(e){try{const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;return t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png").replace(/^data:image\/png;base64,/,"")}catch(e){return console.error("Lỗi khi xử lý ảnh bằng canvas:",e),""}}(async()=>{await async function(){i=await a(e.POWER_ON.key,e.POWER_ON.defaultValue),l=await a(e.API_KEY.key,e.API_KEY.defaultValue)}(),await async function(){if(i&&l&&"YOUR_CLIEN_KEY"!==l&&r){console.log("[image-to-text] Bắt đầu quét tìm captcha...");for(let e=0;e<20;e++){if(u){console.log("[image-to-text] Captcha đã được giải, dừng quét.");break}if(document.querySelector(r.captchaImageSelector)){console.log(`[image-to-text] Tìm thấy ảnh captcha ở lần thử thứ ${e+1}. Bắt đầu giải...`);try{await g()}catch(e){console.error("[image-to-text] Lỗi khi đang giải captcha:",e)}break}console.log(`[image-to-text] Lần thử ${e+1}/20: Không tìm thấy captcha. Đang chờ...`),await o(1e3)}console.log("[image-to-text] Kết thúc quá trình quét tìm captcha.")}else console.log("[image-to-text] Đang tắt image-to-text")}();const c=await a(e.CLOUDFLARE.key,e.CLOUDFLARE.defaultValue);let n=c.isActive||!1,s=c.delayClick||2e3,m=await t(null,"getURL",null);console.log("url omo",m),!m.includes("omocaptcha.com")&&location.href.match("challenges.cloudflare.com/cdn-cgi/challenge-platform/")&&n&&i&&l&&"YOUR_CLIEN_KEY"!==l&&(console.log("match cloudflare:",location.href),function(e){console.log("Cloudflare CAPTCHA Solver: Script injected.");const t=chrome.dom.openOrClosedShadowRoot(document.body);if(!t)return void console.error("Cloudflare CAPTCHA Solver: Không thể truy cập Shadow DOM.");const a=setInterval((()=>{const e=document.getElementById("success");if(e&&"visible"===getComputedStyle(e).visibility)return console.log("Cloudflare CAPTCHA Solver: Đã giải quyết thành công!"),void clearInterval(a);const o=t.querySelector("#content > div > div > label");var c;o?(console.log("Cloudflare CAPTCHA Solver: Tìm thấy checkbox, đang thực hiện click..."),c=o,["pointerdown","mousedown","mouseup","click"].forEach((function(e){c.dispatchEvent(new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window}))}))):console.log("Cloudflare CAPTCHA Solver: Đang chờ checkbox xuất hiện...")}),e)}(s))})()})();