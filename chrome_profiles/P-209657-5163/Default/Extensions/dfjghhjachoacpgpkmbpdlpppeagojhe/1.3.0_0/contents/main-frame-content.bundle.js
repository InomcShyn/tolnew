("undefined"!=typeof browser?browser.runtime:chrome.runtime).onMessage.addListener(((e,t,a)=>{switch(e.type){case"getAllRectIframe":const t=function(){const e=document.querySelectorAll("iframe");return Array.from(e).map(((e,t)=>{const a=e.getBoundingClientRect();return{index:t+1,src:e.src,rect:{top:a.top,left:a.left,width:a.width,height:a.height,bottom:a.bottom,right:a.right}}}))}();a(t);break;case"cropImage":const{screenshotDataUrl:s,cropConfig:o}=e,r=new Image;return r.onload=()=>{try{const e=document.createElement("canvas"),t=window.devicePixelRatio||1;e.width=o.width*t,e.height=o.height*t,e.getContext("2d").drawImage(r,o.left*t,o.top*t,o.width*t,o.height*t,0,0,o.width*t,o.height*t);const s=e.toDataURL("image/png").replace("data:image/png;base64,","");a({base64:s})}catch(e){a({error:e.message})}},r.onerror=()=>a({error:"Không thể load ảnh để crop."}),r.src=s,!0}})),window.addEventListener("message",(e=>{switch(e.data.type){case"getParentData":const t=document.querySelector("[data-sitekey]"),a=t?t.getAttribute("data-sitekey"):null,s=window.location.href;e.source.postMessage({type:"parentDataResponse",siteKey:a,websiteURL:s},e.origin);break;case"setToken":try{const t=document.querySelector('textarea[name="g-recaptcha-response"]');t?(t.value=e.data.token,e.source.postMessage({type:"setTokenResponse",success:!0},e.origin)):e.source.postMessage({type:"setTokenResponse",success:!1,error:"No textarea with name g-recaptcha-response found"},e.origin)}catch(t){e.source.postMessage({type:"setTokenResponse",success:!1,error:t.message},e.origin)}break;case"displayMessage":const{text:o,background:r}=e.data.message,n=document.querySelector("[data-sitekey]");let c=document.getElementById("messageOfToken");!c&&n&&(c=document.createElement("div"),c.id="messageOfToken",c.style.position="relative",c.style.margin="5px auto",c.style.padding="3px 3px",c.style.borderRadius="3px",c.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",c.style.fontSize="12px",c.style.fontWeight="600",c.style.fontFamily="Arial, sans-serif",c.style.textAlign="center",c.style.whiteSpace="nowrap",c.style.color="white",c.style.maxWidth="303px",n.parentNode.insertBefore(c,n.nextSibling)),c&&(c.innerText=o,c.style.background=r,c.style.display="block");break;case"checkboxStateHcaptcha":const i=document.querySelector('iframe[src*="frame=challenge"]');i?.contentWindow&&i.contentWindow.postMessage({type:"checkboxStateHcaptcha",state:e.data.state},"*");break;case"reloadMainPage":window.location.reload()}}));