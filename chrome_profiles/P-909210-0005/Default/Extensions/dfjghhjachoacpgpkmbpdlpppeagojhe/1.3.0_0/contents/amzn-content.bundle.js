(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},APP_ID:{key:"appId",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:25}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},SLIDE_ALL:{key:"slide_all",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},HCAPTCHA:{key:"hcaptcha",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},CLOUDFLARE:{key:"cloudflare",defaultValue:{delayClick:2e3,isActive:!0}}},t=async(e,t)=>{const a="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,r="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const n=await a.get([e]);if(r.lastError)throw new Error(`Error retrieving ${e}: ${r.lastError.message}`);return null!=n[e]?n[e]:t}catch(e){throw e}};Promise.resolve();async function a(e,t,a){const r="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((n,o)=>{r.sendMessage({source:e,type:t,data:a},(e=>{r.lastError?o(new Error(`Error sending message: ${r.lastError.message}`)):n(e)}))}))}catch(e){throw e}}async function r(e){return new Promise((t=>setTimeout(t,e)))}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=document.getElementById("captcha-message");r||(r=document.createElement("div"),r.id="captcha-message",r.style.zIndex="99999999",r.style.padding="3px 3px",r.style.borderRadius="3px",r.style.boxShadow="0 2px 10px rgba(0, 0, 0, 0.2)",r.style.fontSize="10px",r.style.fontWeight="600",r.style.fontFamily="Arial, sans-serif",r.style.textAlign="center",r.style.whiteSpace="nowrap",r.style.color="white",r.style.top="1px",a&&a.parentElement?(r.style.position="absolute",r.style.left="2px",a.parentElement.appendChild(r)):(r.style.position="fixed",r.style.left="1px",document.body.appendChild(r)));const n={success:"linear-gradient(90deg, #6a11cb,rgb(191, 37, 252))",error:"linear-gradient(90deg, #ff416c, #ff4b2b)",warning:"linear-gradient(90deg, #ff9a44, #fc6076)",info:"linear-gradient(90deg, #17a2b8, #138496)"};r.innerText="[OMOcaptcha.com] "+e,r.style.background=n[t]||n.success,r.style.display="block"}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeout:5e3,maxRetries:3,typeImage:"png"};try{const{timeout:a,maxRetries:n,typeImage:o}=t,i=`image/${o||"png"}`,c={arkoselabs:"image/jpeg"};function s(e){for(const[t,a]of Object.entries(c))if(e.includes(t))return a;return i}if(e instanceof HTMLCanvasElement||e.tagName&&"CANVAS"===e.tagName.toUpperCase())try{if(0===e.width||0===e.height)return"";const l=e.getBoundingClientRect(),u=l.width,d=l.height,y=document.createElement("canvas");y.width=u,y.height=d;y.getContext("2d").drawImage(e,0,0,u,d);const f=y.toDataURL(i).split(",")[1];return f||""}catch(p){return""}if(e instanceof Element)try{const m=e.src;if(m&&m.startsWith("data:image/")){const h=m.split(",")[1];return h||""}e=m||""}catch(w){return""}if("string"==typeof e&&e.startsWith("blob:"))try{return await new Promise((t=>{const a=new Image;a.setAttribute("crossOrigin","anonymous");const r=setTimeout((()=>{t("")}),1e3);a.onload=function(){clearTimeout(r);try{const a=document.createElement("canvas");a.width=this.naturalWidth,a.height=this.naturalHeight;a.getContext("2d").drawImage(this,0,0);const r=s(e);a.toBlob((e=>{if(!e)return void t("");const a=new FileReader;a.onloadend=()=>{const e=a.result.split(",")[1];t(e)},a.onerror=()=>t(""),a.readAsDataURL(e)}),r)}catch(e){t("")}},a.onerror=()=>{clearTimeout(r),t("")},a.src=e}))}catch(g){return""}if("string"==typeof e)try{for(let b=0;b<n;b++)try{const k=new AbortController,A=setTimeout((()=>k.abort()),a),E=await fetch(e,{signal:k.signal});if(clearTimeout(A),!E.ok)throw new Error(`HTTP error ${E.status}`);const v=await E.blob();return await new Promise(((e,t)=>{const a=new FileReader;a.onloadend=()=>e(a.result.split(",")[1]),a.onerror=()=>t(new Error("Failed to read blob as base64")),a.readAsDataURL(v)}))}catch(C){if(b===n-1)return"";await r(500)}}catch(S){return""}return""}catch(x){return""}}async function i(e){try{const t=await a("SOURCE","createTask",e);return t||""}catch(e){return""}}async function c(e,t,r){const n=JSON.stringify({clientKey:e,taskId:t});try{const e=await a("SOURCE","getTaskResult",{data:n,timeWait:r});return e?"fail"===e.status?{errorDescription:e.errorDescription}:e.solution?e.solution:e.type?e:null:null}catch(e){return null}}let s,l,u,d,y;async function f(){s=await t(e.POWER_ON.key,e.POWER_ON.defaultValue),l=await t(e.API_KEY.key,e.API_KEY.defaultValue);const a=await t(e.AMZN.key,e.AMZN.defaultValue);u=a.delayClick,d=a.loop,y=a.isActive}let p=!1,m="";async function h(){for(let t=0;t<30;t++){await r(1e3);if(!await w(['[id*="captcha"] [class*="amzn"] canvas'],1e4))return;const t=document.querySelector('[id*="captcha"] [class*="amzn"] em[style*="text"]');if(!t)return;const a=t.textContent;var e=document.querySelector('[id*="captcha"] [class*="amzn"] canvas');if(!e)return;n("Captcha select object","red",e);let s="";for(let t=0;t<10;t++){if(s=await o(e,{timeout:5e3,maxRetries:3}),s&&m!==s){m=s;break}await r(1e3)}if(!s)return;const y=JSON.stringify({clientKey:l,task:{type:"AmznSelectObjectTask",imageBase64:s,other:a}}),f=await i(y);if(!f||f.error){if(n(f?f.errorDescription:"No response","red",e),d){document.querySelector('[id*="amzn-btn-refresh"][type="button"]').click();continue}}else{const t=await c(l,f.taskId,30);if(!t||t.errorDescription){if(n(t?t.errorDescription:"No result from API","red",e),d){document.querySelector('[id*="amzn-btn-refresh"][type="button"]').click();continue}return}n("Solving...","red",e);for(let e=0;e<t.objects.length;e++){e>0&&await r(u);let a=t.objects[e],n=parseInt(a,10);document.querySelectorAll('[class*="amzn"] canvas button')[n].click()}await r(1e3),document.querySelector('[id*="amzn-btn-verify"]').click(),await r(6e3)}}}async function w(e,t){const a=Date.now()+t;for(;Date.now()<a;){for(const t of e){if(document.querySelector(t))return!0}await r(500)}return!1}(async()=>{await f();new MutationObserver((async(e,t)=>{await async function(e){if(await f(),!s||!y||!l||"YOUR_CLIEN_KEY"===l)return;for(const t of e)if("childList"===t.type){if(document.querySelector('[id*="captcha"] [class*="amzn"] canvas')&&!p){if(!l)return;p=!0;try{await r(1e3),await h()}finally{p=!1}}}}(e)})).observe(document.body,{childList:!0,subtree:!0});for(let e=0;e<100;e++){const e=document.querySelector(".amzn-captcha-lang-selector");if(e){const t=e.value;if(t&&"en"!==t)e.value="en",e.dispatchEvent(new Event("change"));else{const e=document.querySelector('[id*="captcha"] button[class*="amzn"]');e&&!p&&e.click()}}await r(1e3)}})()})();